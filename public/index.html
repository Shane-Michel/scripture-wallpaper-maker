<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Scripture Wallpaper Maker - Keyword + Reference</title>

<style>
body {
  margin: 0;
  padding: 20px;
  font-family: "Segoe UI", sans-serif;
  background: #111;
  color: #eee;
  text-align: center;
}

h1 {
  color: #ffdd55;
  font-weight: 600;
  margin-bottom: 10px;
  text-shadow: 0 0 10px #000;
}

#controls {
  margin-bottom: 20px;
}

input, select, button {
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  margin: 6px;
}

button {
  cursor: pointer;
  background: #ffdd55;
  color: #222;
  font-weight: bold;
}

canvas {
  max-width: 100%;
  border-radius: 12px;
  box-shadow: 0 0 20px #000;
}
</style>
</head>
<body>

<h1>Scripture Wallpaper Maker</h1>
<p>Enter a verse (ex: John 3:16) <br> OR a keyword (ex: hope, peace, love)</p>

<div id="controls">
  <input type="text" id="reference" placeholder="Enter Verse or Keyword" />

  <select id="align">
    <option value="center">Center</option>
    <option value="left">Left</option>
    <option value="right">Right</option>
  </select>

  <select id="fontSize">
    <option value="42">Large (42px)</option>
    <option value="32">Medium (32px)</option>
    <option value="24">Small (24px)</option>
  </select>

  <button id="generateBtn">Generate Wallpaper</button>
  <button id="downloadBtn">Download</button>
</div>

<canvas id="wallpaperCanvas" width="1080" height="1920"></canvas>

<script>
const PIXABAY_KEY = "53480329-e7a753209abe9055845aed7e2";
const canvas = document.getElementById("wallpaperCanvas");
const ctx = canvas.getContext("2d");

/* -------------------------------
   KEYWORD â†’ VERSE MAPPING
   (Public domain references, fully safe to use)
--------------------------------*/
const keywordMap = {
  hope: [
    "Jeremiah 29:11",
    "Romans 15:13",
    "Psalm 42:11",
    "Hebrews 11:1",
    "1 Peter 1:3"
  ],
  peace: [
    "John 14:27",
    "Philippians 4:7",
    "Isaiah 26:3",
    "Colossians 3:15"
  ],
  love: [
    "1 Corinthians 13:4-7",
    "John 3:16",
    "1 John 4:19",
    "Romans 5:8"
  ],
  strength: [
    "Philippians 4:13",
    "Isaiah 40:31",
    "Psalm 46:1",
    "Deuteronomy 31:6"
  ],
  faith: [
    "Hebrews 11:1",
    "2 Corinthians 5:7",
    "Mark 11:22"
  ],
  joy: [
    "Nehemiah 8:10",
    "Romans 15:13",
    "Psalm 16:11"
  ],
  anxiety: [
    "Philippians 4:6-7",
    "1 Peter 5:7",
    "Matthew 6:34",
    "Psalm 94:19"
  ],
  healing: [
    "Jeremiah 30:17",
    "Psalm 147:3",
    "Isaiah 53:5",
    "James 5:15"
  ],
  courage: [
    "Joshua 1:9",
    "Deuteronomy 31:6",
    "Psalm 27:14",
    "2 Timothy 1:7"
  ],
  fear: [
    "Isaiah 41:10",
    "Psalm 23:4",
    "2 Timothy 1:7",
    "Psalm 34:4"
  ],
  temptation: [
    "1 Corinthians 10:13",
    "James 4:7",
    "Matthew 26:41",
    "Hebrews 2:18"
  ],
  waiting: [
    "Psalm 27:14",
    "Lamentations 3:25",
    "Psalm 130:5",
    "Isaiah 40:31"
  ],
  marriage: [
    "Ephesians 5:25",
    "Ecclesiastes 4:12",
    "Proverbs 18:22",
    "Genesis 2:24"
  ],
  parenting: [
    "Proverbs 22:6",
    "Ephesians 6:4",
    "Psalm 127:3",
    "Deuteronomy 6:6-7"
  ],
  fasting: [
    "Matthew 6:17-18",
    "Isaiah 58:6",
    "Ezra 8:23",
    "Acts 13:2-3"
  ],
  faithfulness: [
    "Lamentations 3:22-23",
    "1 Corinthians 1:9",
    "Psalm 119:90",
    "Proverbs 3:3-4"
  ],
  "god's promises": [
    "2 Corinthians 1:20",
    "Joshua 21:45",
    "Psalm 145:13",
    "Hebrews 10:23"
  ]
};

async function fetchVerse(reference) {
  const res = await fetch(`https://bible-api.com/${encodeURIComponent(reference)}`);
  if (!res.ok) throw new Error("Verse not found");
  return res.json();
}

async function fetchBackground() {
  const url = `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=nature+landscape+light&image_type=photo&orientation=vertical&per_page=50`;
  const res = await fetch(url);
  const data = await res.json();
  const hits = data.hits;
  if (hits.length === 0) throw new Error("No images found.");
  return hits[Math.floor(Math.random() * hits.length)].largeImageURL;
}

function wrapText(text, x, y, maxWidth, lineHeight) {
  const words = text.split(" ");
  let line = "";
  for (let n = 0; n < words.length; n++) {
    const testLine = line + words[n] + " ";
    const testWidth = ctx.measureText(testLine).width;
    if (testWidth > maxWidth && n > 0) {
      ctx.fillText(line, x, y);
      line = words[n] + " ";
      y += lineHeight;
    } else {
      line = testLine;
    }
  }
  ctx.fillText(line, x, y);
}

async function getReferenceFromKeyword(keyword) {
  keyword = keyword.toLowerCase();
  if (!keywordMap[keyword]) return null;

  const arr = keywordMap[keyword];
  return arr[Math.floor(Math.random() * arr.length)];
}

async function generateWallpaper() {
  let input = document.getElementById("reference").value.trim();
  if (!input) return alert("Enter a verse or keyword.");

  let reference = input;
  
  /* --------------------------
     Detect Keyword (Single Word)
  ---------------------------*/
  if (!input.includes(":") && input.split(" ").length === 1) {
    const match = await getReferenceFromKeyword(input);
    if (!match) return alert("No verses found for this keyword.");
    reference = match;
  }

  // Fetch verse text
  let verseData;
  try {
    verseData = await fetchVerse(reference);
  } catch (err) {
    return alert("Verse not found.");
  }

  const text = verseData.text.trim();
  const verseRef = verseData.reference;

  const bgUrl = await fetchBackground();
  const bgImg = new Image();
  bgImg.crossOrigin = "anonymous";

  bgImg.onload = () => {
    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const fontSize = parseInt(document.getElementById("fontSize").value);
    ctx.font = `bold ${fontSize}px Segoe UI`;
    ctx.fillStyle = "#ffdd55";
    ctx.textBaseline = "top";
    ctx.shadowColor = "#000";
    ctx.shadowBlur = 8;

    const align = document.getElementById("align").value;
    ctx.textAlign = align;

    const margin = 80;
    let x = align === "center" ? canvas.width / 2 :
            align === "left" ? margin : canvas.width - margin;

    wrapText(text, x, 200, canvas.width - margin * 2, fontSize * 1.4);

    ctx.font = "bold 36px Segoe UI";
    ctx.fillStyle = "#fff";
    ctx.shadowBlur = 12;
    ctx.textAlign = "center";
    ctx.fillText(verseRef, canvas.width / 2, canvas.height - 150);
  };

  bgImg.src = bgUrl;
}

document.getElementById("generateBtn").onclick = generateWallpaper;

document.getElementById("downloadBtn").onclick = () => {
  const link = document.createElement("a");
  link.download = "scripture-wallpaper.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};
</script>

</body>
</html>